<!DOCTYPE html>
<html lang='en'>

<head>
    <link href='http://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
    <link href="/static/styling/home.css" rel="stylesheet" />
    <link href="/static/styling/results.css" rel="stylesheet" />
    <script src="/static/scripts/output.js" type="text/javascript"></script>
    <link rel="icon" href="/static/placeholder.jpg" type="image/icon type">
</head>

{% macro output_contents(big_req) -%}
    {% if big_req.is_master_req == True %}
        <div>
            {% for small_req in big_req.fulfilled_by %}
                {% if small_req.is_empty == False %}
                    <button class="collapsible choice" onclick="expand_or_collapse(this)">CHOICE: {{small_req.name}}</button>
                {% endif %}
                
                {% if small_req.is_sub_req == True %}
                    <div class="content">
                    {% for req in small_req.fulfilled_by %}
                        {% if req.is_empty == False %}                        
                            <button class="collapsible subreq" onclick="expand_or_collapse(this)">SUB REQUIREMENT: {{req.name}}</button>
                        {% endif %}

                        <div class="content">
                        {% for dept in req.classes %}
                            {% for course in req.classes[dept] %}
                                <button class="collapsible subreq-course" onclick="expand_or_collapse(this)">{{dept}} {{course.num}}: {{course.title}}</button>
                                <!-- Display the classes -->
                                <div class="content">
                                    <table class='subreq-course'>
                                        <tr>
                                            <th>Code</th>
                                            <th>Type</th>
                                            <th>Professor</th>
                                            <th>Time</th>
                                            <th>Location</th>
                                            <th>Max</th>
                                            <th>Enrolled</th>
                                            <th>WL</th>
                                            <th>Rstr</th>
                                            <th>Status</th>
                                        </tr>
                                        {% for offering in course.offerings %}
                                            <tr>
                                                {% for attr in offering.values() %}
                                                    <td> {{attr}} </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            {% endfor %}
                        {% endfor %}
                        </div>

                    {% endfor %}                  
                    </div>
                
                {% elif small_req.is_sub_req == False %}
                    <!-- display class name buttons within the subreq -->
                    <div class="content">
                        {% for dept in small_req.classes %}
                            {% for course in small_req.classes[dept] %}
                                <button class="collapsible course" onclick="expand_or_collapse(this)">{{dept}} {{course.num}}: {{course.title}}</button>
                                <!-- Display the classes -->
                                <div class="content">
                                    <table class='course'>
                                        <tr>
                                            <th>Code</th>
                                            <th>Type</th>
                                            <th>Professor</th>
                                            <th>Time</th>
                                            <th>Location</th>
                                            <th>Max</th>
                                            <th>Enrolled</th>
                                            <th>WL</th>
                                            <th>Rstr</th>
                                            <th>Status</th>
                                        </tr>
                                        {% for offering in course.offerings %}
                                            <tr>
                                                {% for attr in offering.values() %}
                                                    <td> {{attr}} </td>
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>

                {% endif %}

            {% endfor %}  
        </div>
            
        <!-- If its just a regular requirement then show the classes in it -->
        {% elif big_req.is_master_req == False %}
            <div>
                {% for dept in big_req.classes %}
                    {% for course in big_req.classes[dept] %}
                        <button class="first-level-course" onclick="expand_or_collapse(this)">{{dept}} {{course.num}}: {{course.title}}</button>
                        <!-- Display the classes -->
                        <div class="content">
                            <table class='first-level-course  '>
                                <tr>
                                    <th>Code</th>
                                    <th>Type</th>
                                    <th>Professor</th>
                                    <th>Time</th>
                                    <th>Location</th>
                                    <th>Max</th>
                                    <th>Enrolled</th>
                                    <th>WL</th>
                                    <th>Rstr</th>
                                    <th>Status</th>
                                </tr>
                                {% for offering in course.offerings %}
                                    <tr>
                                        {% for attr in offering.values() %}
                                            <td> {{attr}} </td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    {% endfor %}
                {% endfor %}
            {% endif %}
            </div>
{%- endmacro %}

<body>
    <header id="output">
        <div class="header-left">
            <img src="/static/placeholder.jpg" alt="zotsoc" id="logoimg"/>  
            <a href="/"> zotSOC </a>
        </div>              
    </header>

    <div class="saved">
        <div id="saved-heading">
            <h1>Saved</h1>
        </div>
        
        <div id="saved-classes">
        </div>
        
    </div>

    <div class="results">
        <div class="big-requirement-area">
            <div class="big-requirement-list">
                <h1>Available Big Requirements</h1>
                {% for big_requirement in courses %}
                    {% if big_requirement.is_empty == False %}
                        <button id="button-{{loop.index}}" class="big-requirement" onclick="showContents(this)"> {{big_requirement.name}}</button>
                    {% endif %}
                {% endfor %}                
            </div>
           
        </div>

        <div id="big-requirement-contents">
            <p> Select a big requirement to see its contents. </p>
        </div>  

        {% for big_requirement in courses %}
            <div class="output" id="{{loop.index}}">
                {{output_contents(big_requirement)}}
            </div>             
        {% endfor %}
    
    </div>
</body>

<script>
    function showContents(bigReqButton) {
        makeActive(bigReqButton);
        var contents = document.getElementById("big-requirement-contents");
        var split_id = bigReqButton.id.split("-");
        var id_num = split_id[1];
        var selected = document.getElementById(id_num);
        contents.innerHTML = selected.innerHTML;
    }

    function makeActive(bigReqButton) {
        var bigReqButtons = document.getElementsByClassName("big-requirement");
        var i;
        for (i=0; i < bigReqButtons.length; i++) {
            if (bigReqButtons[i].classList.contains("active")) {
                bigReqButtons[i].classList.toggle("active");
            }
        }
        bigReqButton.classList.toggle("active");
    }

    function expand_or_collapse(button_clicked) {
        var content = button_clicked.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";

            var allChildren = content.children;
            for (var i = 0; i < allChildren.length; i++) {
                var contentChild = allChildren[i];
                if (contentChild.className === "content") {
                    contentChild.style.display = "none";
                }                
            }
        } 
        else {
            content.style.display = "block";
        } 
    }
</script>
</html>
